<html>
  <head>
    <title>Socket.IO chat</title>
  </head>
  <body>
    <div id="main">
        
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script>
        var userID;
        var socket = io();
        loginandsetup();
        function loginandsetup(){            
            $loginnameinput = document.createElement("input");
            $loginnameinput.style = "width: 100px; height: 20px;";
            $loginnameinput.id = "loginusername";
            $loginnameinput.placeholder = "username";
            
            $loginpassinput = document.createElement("input");
            $loginpassinput.style = "width: 100px; height: 20px;";
            $loginpassinput.id = "loginpassword";
            $loginpassinput.placeholder = "password";
            
            $loginbutton = document.createElement("button");
            $loginbutton.style = "width: 100px; height: 20px;";
            $loginbutton.id = "loginsubmit";
            $loginbutton.append("login");
            
            $('#main').append("login"+"<br>");
            $('#main').append($loginnameinput);
            $('#main').append($loginpassinput);
            $('#main').append($loginbutton);
            
            $('#loginsubmit').click(function(e){
                e.preventDefault(); // prevents page reloading
                socket.emit('login', $('#loginusername').val(),$('#loginpassword').val());
                return false;
            });
            
            $signupnameinput = document.createElement("input");
            $signupnameinput.style = "width: 100px; height: 20px;";
            $signupnameinput.id = "signupusername";
            $signupnameinput.placeholder = "username";
            
            $signuppassinput = document.createElement("input");
            $signuppassinput.style = "width: 100px; height: 20px;";
            $signuppassinput.id = "signuppassword";
            $signuppassinput.placeholder = "password";
            
            $signupbutton = document.createElement("button");
            $signupbutton.style = "width: 100px; height: 20px;";
            $signupbutton.id = "signupsubmit";
            $signupbutton.append("login");
            
            $('#main').append("<br>"+"signup"+"<br>");
            $('#main').append($signupnameinput);
            $('#main').append($signuppassinput);
            $('#main').append($signupbutton);
            
            $('#signupsubmit').click(function(e){
                e.preventDefault(); // prevents page reloading
                socket.emit('signup', $('#signupusername').val(),$('#signuppassword').val());
                return false;
            });
        }
        
        function clear(){
            $("#main").empty();
        }
        
        function usersite(name){
            $chatnameinput = document.createElement("input");
            $chatnameinput.style = "width: 100px; height: 20px;";
            $chatnameinput.id = "chatname";
            $chatnameinput.placeholder = "username";
            
            $chatbutton = document.createElement("button");
            $chatbutton.style = "width: 100px; height: 20px;";
            $chatbutton.id = "chatsubmit";
            $chatbutton.append("Create Chat");
            
            $('#main').append("hi: " + name +"<br>");
            $('#main').append("CreateChat"+"<br>");
            $('#main').append($chatnameinput);
            $('#main').append($chatbutton);
            
            $('#chatsubmit').click(function(e){
                console.log("button pressed");
                e.preventDefault(); // prevents page reloading
                socket.emit('createchat', $('#chatname').val(),userID);
                return false;
            });
        }
        
        function addchatbutton(chatnavn,chatid){
            $selectchatbutton = document.createElement("button");
            $selectchatbutton.id = chatid;
            $selectchatbutton.value = chatid;
            $selectchatbutton.append(""+chatnavn+"");
            $selectchatbutton.style = "width: 100px; height: 20px;";
            
            $('#main').append("<br>");
            $('#main').append($selectchatbutton);
            
            
            $('#'+chatid).click(function(e){
                console.log("you pressed "+$('#'+chatid).val());
                
            });
        }
        
        socket.on('login', function(msg,ID,name){
            if(msg){
                userID = ID;
                clear();
                usersite(name);
                socket.emit('chatQuery', userID);
            }
        });
        socket.on('errormsg', function(msg){
            alert(msg);
        });
        socket.on("ch",function(ChatNavn,ChatId){
            console.log(ChatNavn);
            console.log(ChatId);
            addchatbutton(ChatNavn,ChatId);
        });
    </script>
  </body>
</html>